ytdl-sub:
  controllers:
    main:
      type: cronjob
      cronjob:
        suspend: false
        concurrencyPolicy: Forbid
        timeZone: US/Central
        schedule: 12 0 * * *
        startingDeadlineSeconds: 90
        successfulJobsHistory: 1
        failedJobsHistory: 1
        backoffLimit: 3
        parallelism: 1
      containers:
        main:
          image:
            repository: ghcr.io/jmbannon/ytdl-sub
            tag: 2025.12.30
            pullPolicy: IfNotPresent
          command:
            - ytdl-sub
            - -c
            - /config/config.yaml
            - sub
          env:
            - name: TZ
              value: America/Chicago
            - name: CRON_RUN_ON_START
              value: false
          resources:
            requests:
              cpu: 10m
              memory: 128Mi
  configMaps:
    config:
      enabled: true
      data:
        config.yaml: |
          configuration:
            working_directory: /cache
        subscriptions.yaml: |
          __preset__:
            embed_thumbnail: True
            square_thumbnail: True
            overrides:
              music_directory: /music
          YouTube Releases | Max MP3 Quality:
            = YouTube:
              "Music Saved": "https://www.youtube.com/playlist?list=PLtiOoYqxYXtKK3fMya_xhqK0Wit0i10Gy&si=8wNBH-kGT9Nx0XBK"

  persistence:
    config:
      enabled: true
      type: configMap
      name: ytdl-sub
      advancedMounts:
        main:
          main:
            - path: /config/config.yaml
              readOnly: true
              mountPropagation: None
              subPath: config.yaml
            - path: /config/subscriptions.yaml
              readOnly: true
              mountPropagation: None
              subPath: subscriptions.yaml
    cache:
      type: emptyDir
      advancedMounts:
        main:
          main:
            - path: /cache
              readOnly: false
    music:
      existingClaim: ytdl-sub-nfs-storage
      advancedMounts:
        main:
          main:
            - path: /music
              readOnly: false
