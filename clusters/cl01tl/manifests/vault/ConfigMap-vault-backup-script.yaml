apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-backup-script
  namespace: vault
  labels:
    app.kubernetes.io/name: vault-backup-script
    app.kubernetes.io/instance: vault
    app.kubernetes.io/part-of: vault
data:
  backup.sh: |
    echo " ";
    echo ">> Running S3 backup for Vault snapshot";
    if s3cmd sync --no-check-certificate -v /opt/backup "${BUCKET}/cl01tl/cl01tl-vault-snapshots/"; then
        echo ">> Sync succeeded"
    else
        echo ">> ERROR: Sync failed"
    fi
