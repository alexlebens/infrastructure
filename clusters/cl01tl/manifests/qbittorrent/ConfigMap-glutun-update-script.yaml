apiVersion: v1
kind: ConfigMap
metadata:
  name: glutun-update-script
  namespace: qbittorrent
  labels:
    app.kubernetes.io/name: glutun-update-script
    app.kubernetes.io/instance: qbittorrent
    app.kubernetes.io/part-of: qbittorrent
data:
  update.sh: |
    if ! command -v curl 2>&1 >/dev/null
    then
        echo "curl could not be found, installing";
        apk add curl;
    fi;
    curl -i -X POST --silent --write-out '%{http_code}' -d "json={\"random_port\": \"true\"}" "http://localhost:8080/api/v2/app/setPreferences";
    sleep 10
    echo "updating port with $1";
    curl -i -X POST --silent --write-out '%{http_code}' -d "json={\"listen_port\": \"${1}\"}" "http://localhost:8080/api/v2/app/setPreferences";
