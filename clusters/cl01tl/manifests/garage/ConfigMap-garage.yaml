apiVersion: v1
kind: ConfigMap
metadata:
  name: garage
  labels:
    app.kubernetes.io/instance: garage
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: garage
    helm.sh/chart: garage-4.5.0
  namespace: garage
data:
  garage.toml: |
    replication_factor = 3

    metadata_dir = "/var/lib/garage/meta"
    data_dir = "/var/lib/garage/data"
    metadata_snapshots_dir = "/var/lib/garage/snapshots"

    db_engine = "lmdb"

    metadata_auto_snapshot_interval = "6h"

    compression_level = 3

    rpc_addr = "[::]"

    allow_world_readable_secrets = false

    [s3_api]
    s3_region = "us-east-1"
    api_bind_addr = "[::]:3900"
    root_domain = ".garage-s3.alexlebens.net"

    [s3_web]
    bind_addr = "[::]:3902"
    root_domain = ".garage-s3.alexlebens.net"

    [admin]
    api_bind_addr = "[::]:3903"
    metrics_require_token = true
