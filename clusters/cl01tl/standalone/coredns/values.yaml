coredns:
  image:
    repository: registry.k8s.io/coredns/coredns
    tag: v1.11.3
  replicaCount: 3
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
  rollingUpdate:
    maxUnavailable: 1
    maxSurge: 25%
  terminationGracePeriodSeconds: 30
  serviceType: "ClusterIP"
  prometheus:
    service:
      enabled: true
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9153"
    monitor:
      enabled: true
      namespace: kube-system
  service:
    ipFamilyPolicy:
       IPv4
    name: kube-dns
    selector:
      k8s-app: kube-dns
  serviceAccount:
    create: true
    name: coredns
  rbac:
    create: true
  isClusterService: true
  priorityClassName: system-cluster-critical
  securityContext:
    capabilities:
      add:
        - NET_BIND_SERVICE
      drop:
        - ALL
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
  servers:
    - zones:
      - zone: .
        port: 53
        plugins:
          - name: errors
          - name: health
            configBlock: |-
              lameduck 5s
          - name: ready
          - name: kubernetes
            parameters: cluster.local in-addr.arpa ip6.arpa
            configBlock: |-
              pods insecure
              fallthrough in-addr.arpa ip6.arpa
          - name: prometheus
            parameters: :9153
          - name: forward
            parameters: . /etc/resolv.conf
          - name: cache
            parameters: 30
          - name: loop
          - name: reload
          - name: loadbalance
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: k8s-app
                  operator: In
                  values:
                    - kube-dns
            topologyKey: kubernetes.io/hostname
  nodeSelector:
    kubernetes.io/os: linux
  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule
    - key: node.cloudprovider.kubernetes.io/uninitialized
      operator: Exists
      effect: NoSchedule
  deployment:
    skipConfig: false
    enabled: true
    name: coredns
    selector:
      matchLabels:
        k8s-app: kube-dns
