argo-cd:
  crds:
    install: true
  configs:
    cm:
      admin.enabled: true
      timeout.reconciliation: 100s
      timeout.reconciliation.jitter: 60s
      url: https://argocd.alexlebens.net
      statusbadge.url: https://argocd.alexlebens.net/
      statusbadge.enabled: true
      dex.config: |
        connectors:
        - config:
            issuer: https://authentik.alexlebens.net/application/o/argocd/
            clientID: $argocd-oidc-secret:client
            clientSecret: $argocd-oidc-secret:secret
            insecureEnableGroups: true
            scopes:
              - openid
              - profile
              - email
          name: authentik
          type: oidc
          id: authentik
    params:
      server.insecure: true
    rbac:
      policy.csv: |
        g, ArgoCD Admins, role:admin
    cmp:
      create: true
      plugins:
        cdk8s:
          init:
            command: [cdk8s]
            args: [import]
          generate:
            command: [cdk8s, synth]
            args: [--stdout]
          discover:
            fileName: "*.go"
  controller:
    replicas: 1
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
  dex:
    enabled: true
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    livenessProbe:
      enabled: true
    readinessProbe:
      enabled: true
  redis-ha:
    enabled: true
    auth: false
  redisSecretInit:
    enabled: true
  server:
    replicas: 2
    ingress:
      enabled: false
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
  repoServer:
    replicas: 2
    extraContainers:
      - name: cmp-cdk8s
        command:
          - /var/run/argocd/argocd-cmp-server
        image: ghcr.io/akuity/cdk8s-cmp-typescript:1.0
        securityContext:
          runAsNonRoot: true
          runAsUser: 999
        volumeMounts:
          - mountPath: /var/run/argocd
            name: var-files
          - mountPath: /home/argocd/cmp-server/plugins
            name: plugins
          - mountPath: /home/argocd/cmp-server/config/cdk8s.yaml
            subPath: cdk8s.yaml
            name: argocd-cmp-cm
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
  applicationSet:
    replicas: 2
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    livenessProbe:
      enabled: true
    readinessProbe:
      enabled: true
  notifications:
    enabled: true
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    livenessProbe:
      enabled: true
    readinessProbe:
      enabled: true
