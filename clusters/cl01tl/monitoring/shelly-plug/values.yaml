shelly-plug:
  controllers:
    main:
      type: deployment
      replicas: 1
      strategy: Recreate
      revisionHistoryLimit: 3
      initContainers:
        init-clone-repo:
          securityContext:
            runAsUser: 0
          image:
            repository: alpine/git
            tag: 1.37.0
            pullPolicy: IfNotPresent
            args:
              - clone
              - '--single-branch'
              - '--'
              - 'https://github.com/geerlingguy/shelly-plug-prometheus.git'
              - '/var/www/html'
          resources:
            requests:
              cpu: 10m
              memory: 128Mi
      containers:
        main:
          image:
            repository: php
            tag: 8.2.28-apache-bookworm
            pullPolicy: IfNotPresent
          env:
            - name: SHELLY_HOSTNAME
              value: it05sp.alexlebens.net
          envFrom:
            - secretRef:
                name: shelly-plug-config-secret
          resources:
            requests:
              cpu: 10m
              memory: 64Mi
  service:
    main:
      controller: main
      ports:
        metrics:
          port: 80
          targetPort: 80
          protocol: TCP
  persistence:
    script:
      storageClass: ceph-block
      accessMode: ReadWriteOnce
      size: 1Gi
      retain: true
      advancedMounts:
        main:
          init-clone-repo:
            - path: /var/www/html
              readOnly: false
          main:
            - path: /var/www/html
              readOnly: false
